
services:
  mysql-db:
    environment:
      MYSQL_ROOT_PASSWORD: testroot
      MYSQL_PASSWORD: testuser
      MYSQL_DATABASE: test_connector_db
    ports:
      - "3307:3306"  # Different port for testing
    volumes:
      - mysql_test_data:/var/lib/mysql
      - ./database/init:/docker-entrypoint-initdb.d:ro

  connector-api:
    environment:
      - SECRET_KEY=test-secret-key
      - LOG_LEVEL=DEBUG
      - DATABASE_URL=mysql://connector_user:testuser@mysql-db:3306/test_connector_db
      - REDIS_URL=redis://redis-cache:6380/1  # Different DB for testing
    volumes:
      - ./connector-server:/app
    ports:
      - "3001:3000"  # Different port

  redis-cache:
    ports:
      - "6380:6379"  # Different port

volumes:
  mysql_test_data:
    driver: local